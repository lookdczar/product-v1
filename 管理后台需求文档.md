用户管理和权限管理需求文档[模块名称]需求文档 

名词/缩略词解释
对文档中出现的专业术语、缩写词等进行解释。例如，UGC（用户生成内容）、API（应用程序编程接口）等。
- 用户的定义
  - 学必优平台的用户分成两大类，一类是外部用户，一类是内部员工用户。
  - 外部用户，包括学生，老师，家长，代理人等很多类
  - 内部员工用户，都是学必优自己的员工
- 权限的定义
用户对某项资源是否拥有某项操作的权利。
- 权限和用户是紧密关联的，离开了用户，权限就失去了意义，这里的权限指的是某个功能操作的权限，有某项权限就可以进行某项操作，如果没有就不能进行操作。
- 资源的定义
        资源（Resource）是系统中需要被保护或控制访问的实体对象，通常对应业务场景中的具体数据或功能模块。资源包括但不限于前端页面的菜单和按钮、数据，数据又有试卷、课件等不同的类型。资源具有可标识性：每个资源需有唯一标识（如ID、路径）
1. 需求背景&目标
- 用户痛点 ：当前用户反馈或数据表现（附截图或埋点数据）
- 竞品参考 ：如有竞品方案，需说明差异化设计点（看情况补充）
- 场景说明 ：
  - 用户管理
    - 创建外部账号
      - 外部用户要成为学必优会员，需要拥有学必优用户账号，通常由用户通过账号注册自主注册创建自己的账号
        - 有一种特殊情况，可以由学必优官方直接创建外部用户账号，再交给用户使用，在特殊的场景会出现这种情况。例如，我们想让某学校校长体验学必优产品，我们可以告诉校长学必优域名或者APP，告诉他如何通过页面一步步完成注册，如果我们担心校长时间宝贵，注册账号比较耗时间，也可以由学必优通过管理后台直接创建一个账号，填入一些初始数据，再把账号交给校长使用。
    - 创建内部账号
      - 公司通过信息管理系统的管理员账号为员工创建用户账号，分配给员工登录使用
  - 模块管理
    - 模块的增删改查
  - 菜单管理
    - 菜单分为管理后台和各客户端的菜单
  - 权限管理
    - 针对内部管理后台，做菜单、数据等着资源的权限管理
    - 针对外部用户的各端（app、pc、web等），做菜单、数据等资源的权限管理
- 业务目标 ：解决什么问题？提升DAU/留存/变现？
- 在学必优在线教育管理后台实现对用户的管理和权限的管理，学必优教育的信息管理系统是给学必优员工使用的，通过管理系统完成对学必优所有业务的精细化管理
- 用户管理模块要实现对外部用户和内部用户的分开管理
- 用户注册账号需要录入一系列的个人信息，通过用户账号信息学必优就获取到该用户的相关信息。用户创建完账号后，该用户的信息会出现在用户列表菜单的数据列表中，学必优可以对用户信息进行查看编辑等操作
2. 需求范围 
暂时无法在飞书文档外展示此内容

 详细需求描述 
用户管理模块
 3.1 功能描述
用户指的是外部用户。用户管理实现用户账号的创建，编辑，删除，查看，锁定，解锁，启用，停用，权限分配等功能，同时对每一次操作创建操作日志
1.1.模块名称：用户管理
1.2.模块包括菜单有：用户列表（用户），用户分类，用户属性，用户角色，用户组，回收站，操作日志
 3.2 页面设计与交互流程 
- 用户列表（用户）所有的用户都会在数据列表分页呈现，最新创建的用户档案默认会排在数据列表第一行，在功能标签栏，可以设计排序标签，时间顺序时间倒序切换标签，ant design组件支持这一功能控件。操作功能有创建（新增）删除， 编辑，查看，锁定，解锁，启用，停用等。其中创建（新增）按钮在功能标签栏，其余功能都在数据列表区右部的功能操作区。采用文字按钮更直观，不使用图标按钮。
  - 排序的字段可支持时间排序、id排序、其他属性。
  - 针对锁定的说明 。
    - 背景
      - 出于安全的考虑，在账号有风险的情况下去通过锁定账号去保护用户数据。
    - 场景
      - 用户频繁异地登录，系统可能会判定用户账号被盗，从而系统内部做账号锁定操作
      - 公安机关调查某个异常用户
    - 说明
      - 锁定的范围与影响
        - 被锁定的用户不允许编辑个人信息
        - 其他
  - 针对停用的说明
- 用户分类（Category） 创建和管理用户分类，这是创建用户信息的前置准备，有了分类，在创建用户档案时，用户档案页面才会出现用户分类可选项，支持选择一个或者多个用户分类，通过勾选选择框实现
  - 分类的说明：
    - 分类可创建和编辑，技术上要灵活支持，估计会有分类id字段，前端也要适配分类id。
    - 分类例子，例如供应商和销售等不同身份，学生和老师等不同身份
    - 不同的分类，会有不同的属性集
- 用户属性（Attribute） 创建和管理用户属性，这是创建用户信息的前置准备。每一个属性表现为一个字段信息，通过多个字段信息对用户进行描述，有了属性，创建用户档案的页面信息才会出现这些信息项。属性可以绑定分类，也就是和分类进行关联，该属性适用于哪些分类，实现不同类型的用户有不同的描述字段信息。举例：例如学生的用户名，姓名，昵称，性别，年级等都是属性
  - 固定属性：例如用户的姓名、年龄、性别
  - 可扩展属性：
是另外一个表，有属性id、value、分类、描述（100字内）、名称、是否必填字段。支持锁定和解锁、启用停用。
创建用户属性时，要指定分类用于划分属性集，例如裤子和上衣这两种分类，会有不同的属性集，例如家长和学生，也有不同的属性集。
支持属性自身的类型，例如范围描述，例如裤长属性，这个裤长又有合法性范围
- 用户角色User Role 创建和管理用户角色。自定义方式创建角色，用户可以属于多种角色。角色和分类是两个不同的描述维度，分类是从分类规则看用户属于什么样的类型，角色更多的是从用户所需要的操作功能层面进行描述，角色最大的意义是快速定义用户的操作权限。一个角色档案的主要信息是角色名称，角色权限。在给用户分配权限时，就可以通过选择一个或者多个角色，快速确定用户的权限，如果用户有多个角色，其权限是多个角色的合集。
  - 外部用户的角色和内部用户的角色是完全独立的。
  - 还可以增加角色分类（这里的角色分类和上面的用户分类是互相独立的），角色属性，先创建角色分类和属性，再创建角色，在创建角色时，先选择一个分类，这样便于对某个角色有一个清晰的定位，当然创建角色的详情页面里面有角色描述。可做可不做，做的话就更灵活，不做就直接在数据库表写入需要的字段。
  - 角色描述（100字内）
  - 角色关联的权限（多选）
  - 前端支持创建新角色时，其关联的权限集合可以通过勾选其他已有角色的权限集合来快速选择一部分权限，然后可以删掉或者新增其他选项，从而最终快速选择新角色的权限集合。类似发朋友圈时迅速圈定朋友可见性范围
- 用户组 User Group 创建和管理用户组，这是创建用户信息的前置准备，可以由学必优官方创建，也可以由用户创建，需要学必优审核通过再生效，以避免创建很多无效的用户组。通过用户组功能，例如把同一个学校或者同一个班级的所有用户创建为一个用户组，有了用户组，在用户创建注册时就可以选择加入某个用户组，让同一个用户组的成员可以看到其他成员的信息。或者由学必优按照规则控制，具体根据需求场景确定
  - 例如给老师创建班级。
  - 学生可以自己加入班级，但是需要老师或者管理员审核
  - 学生加入班级，界面支持搜索功能，方便学生快速搜到自己所属的学校和班级
  - 创建班级，依赖学校和年级的创建。我们定期维护和更新全国学校的集合，让学生注册时可搜索选择自己所在学校。同时，因为我们的学校数据库可能更新不及时或者本身可能数据不全，所以在学生注册时，学生可能找不到自己的学校，这时候用户可以提交一个创建学校的请求并提交后台审核，后台审核通过后再通知用户。
    - 创建学校的审核页面如何做？
- 回收站 确定不需要的用户档案删除到回收站，一般不进行删除操作
  - 数据库不做硬删除，只做软标记。所以数据库要增加一个用户是否已删除字段。
- 操作日志 每一次操作完成时生成一条操作日志
  - 操作人
  - 操作时间
  - 操作类型
    - 删除、增加、编辑、查询等等，做成类型可以方便后续搜索过滤
    - 所以这个类型的枚举，后面定一下
  - 操作内容
  - 操作日志最多保留三年 -- 灵活处理
- 注意：特殊意义的用户名禁止使用
  - 敏感词服务
  - 如果敏感词范围变更，那么要做已有的用户信息的清洗，如果有违规的话，要定一个处理方式
    - 具体处理方式，参考通用的处理方式，或者停用，或者我们直接修改用户名等等
    - 如何通知，例如站内站外等。
- 用户权限查看 查看用户权限，可以查看用户的权限 
  - 指的是内部员工查看某个外部用户的权限
  - 管理后台要支持搜索外部用户 -- 需要es
- 用户权限分配，一般通过选择确定用户的角色来快速完成对用户权限的分配，用户拥有某项权限才能看到对应的菜单和功能，才能进行某项功能操作。一种方式是通过用户列表右部操作区的权限分配按钮进行，一种是通过功能标签栏的权限分配按钮进行，此时需要搜选用户，相当于有两种入口。
  - 支持直接分配权限，也支持给用户关联角色
员工管理模块
3.1 功能描述
创建员工管理模块，管理内部员工用户。
第一阶段开发的菜单类似于用户管理模块，后面再增加菜单，或者新的管理模块
员工管理模块和用户管理模块有一些共同的功能，但是他们的具体实现是完全隔离的，包括底层数据表和微服务都是完全隔离的，例如后面的角色管理和操作日志。
 3.2 页面设计与交互流程 
- 员工管理模块
  - 员工账号的分类有root系统管理员，admin 超级管理员，普通管理员，普通用户
    - 数据库预留账号分类字段
    - root用户具有最高权限
    - 注意，root是最高管理员，系统级管理员，系统最先创建的是root账号，之后由root创建admin账号，由admin创建其他员工用户账号
    - 特殊意义的用户名禁止使用
    - 谁可以创建、删除、修改权限？
      - 只有root账号可以
    - 权限实现路径：如何实现某个账号能看到哪些可分配权限从而分配给其下级人员，例如root能看到所有权限，admin可能只能看到一部分，普通管理员可能只能看到更少的一部分权限
      - 业务实现：root可以创建admin后，给admin设定可分配的权限集合，同理，admin也可以创建普通管理员，并给普通管理员设定可分配的权限集合，权限集合不能超过上一级账号的权限集合。
      - 技术实现。先调研casbin支不支持，可能是权限继承那一块。从数据来看，每个内部账号有两个数据，一个是自己拥有哪些权限，另外一个是自己可以分配哪些权限给其他人员。
      - 如果root已经给普通管理员分配了可分配权限列表，后面如果发现有风险，某个要回收或者是其他变更，那么是否要递归的回收普通管理员分配出去给其他人员的这个权限
- 用户列表（用户）所有的用户都会在数据列表分页呈现，最新创建的用户档案默认会排在数据列表第一行，在功能标签栏，可以设计排序标签，时间顺序时间倒序切换标签，ant design组件支持这一功能控件。操作功能有创建（新增）删除， 编辑，查看，锁定，解锁，启用，停用等。其中创建（新增）按钮在功能标签栏，其余功能都在数据列表区右部的功能操作区。采用文字按钮更直观，不使用图标按钮。
  - 排序的字段可支持时间排序、id排序、其他属性。
  - 针对锁定的说明 。
    - 背景
    - 场景
    - 说明
      - 锁定的范围与影响
        - 被锁定的用户不允许编辑员工个人信息，个人信息不包括权限，因为权限可以在其他地方单独控制
  - 针对停用的说明
    - 不能登录，不能使用整个管理后台的功能
  - 以上停用和锁定操作，也属于权限管理的一部分，而且，要考虑权限大小问题，技术上不做限制（例如如果不小心把停用权限分配给普通人员了，普通人员也可以停用一个管理员的账号），而是业务逻辑做限制：分配停用和锁定权限时，不能随便分配。
- 管理对象范围的控制
  - 场景
    - 例如老师可以去修改班级里面其他学生的某些信息，这是一种权限，需要控制老师只能修改自身班级学生的信息，而不能超出自身班级去修改其他学生的信息
    - 例如销售一部的负责人，可以去修改其部门内部人员的权限，但是不能修改超出自身部门的其他人员的权限
  - 功能
    - 支持给某个用户分配其管理对象范围
      - 谁可以分配？---由权限控制
      - 具体的分配，可能是手动在管理后台配置，也可以是一些规则来自动分配，例如老师注册后，自动给他分配管理某个班的权限
    - 支持修改某个用户的可管理对象范围
      - 谁可以修改？---由权限控制
    - 在用户管理其管理对象时，技术上要做权限控制，如果超出用户的管理对象范围，则拒绝请求
- 用户分类（Category） 创建和管理用户分类，这是创建用户信息的前置准备，有了分类，在创建用户档案时，用户档案页面才会出现用户分类可选项，支持选择一个或者多个用户分类，通过勾选选择框实现
  - 分类的说明：
    - 分类可创建和编辑，技术上要灵活支持，估计会有分类id字段，前端也要适配分类id。
    - 分类例子，例如供应商和销售等不同身份，例如不同的部门等等
    - 不同的分类，会有不同的属性集
- 用户属性（Attribute） 创建和管理用户属性，这是创建用户信息的前置准备。每一个属性表现为一个字段信息，通过多个字段信息对用户进行描述，有了属性，创建用户档案的页面信息才会出现这些信息项。属性可以绑定分类，也就是和分类进行关联，该属性适用于哪些分类，实现不同类型的用户有不同的描述字段信息。举例：例如学生的用户名，姓名，昵称，性别，年级等都是属性
  - 固定属性：例如用户的姓名、年龄、性别
  - 可扩展属性：
是另外一个表，有属性id、value、分类、描述（100字内）、名称、是否必填字段。支持锁定和解锁、启用停用。
创建用户属性时，要指定分类用于划分属性集，例如裤子和上衣这两种分类，会有不同的属性集，例如家长和学生，也有不同的属性集。
支持属性自身的类型，例如范围描述，例如裤长属性，这个裤长又有合法性范围
- 用户角色User Role 创建和管理用户角色。自定义方式创建角色，用户可以属于多种角色。角色和分类是两个不同的描述维度，分类是从分类规则看用户属于什么样的类型，角色更多的是从用户所需要的操作功能层面进行描述，角色最大的意义是快速定义用户的操作权限。一个角色档案的主要信息是角色名称，角色权限。在给用户分配权限时，就可以通过选择一个或者多个角色，快速确定用户的权限，如果用户有多个角色，其权限是多个角色的合集。
  - 外部用户的角色和内部用户的角色是完全独立的。
  - 还可以增加角色分类（这里的角色分类和上面的用户分类是互相独立的），角色属性，先创建角色分类和属性，再创建角色，在创建角色时，先选择一个分类，这样便于对某个角色有一个清晰的定位，当然创建角色的详情页面里面有角色描述。可做可不做，做的话就更灵活，不做就直接在数据库表写入需要的字段。
  - 角色描述（100字内）
  - 角色关联的权限（多选）
  - 前端支持创建新角色时，其关联的权限集合可以通过勾选其他已有角色的权限集合来快速选择一部分权限，然后可以删掉或者新增其他选项，从而最终快速选择新角色的权限集合。类似发朋友圈时迅速圈定朋友可见性范围
- 用户组 User Group 创建和管理用户组，这是创建用户信息的前置准备，可以由学必优官方创建，也可以由用户创建，需要学必优审核通过再生效，以避免创建很多无效的用户组。通过用户组功能，例如把同一个学校或者同一个班级的所有用户创建为一个用户组，有了用户组，在用户创建注册时就可以选择加入某个用户组，让同一个用户组的成员可以看到其他成员的信息。或者由学必优按照规则控制，具体根据需求场景确定
  - 例如创建一个设计部门或者其他部门。
  - 某个内部用户的所属用户组，可以在用户创建时指定，也可以后期修改。这里界面要支持搜索用户组
    - 谁有指定用户的用户组的权限，由权限控制
- 回收站 确定不需要的用户档案删除到回收站，一般不进行删除操作
  - 数据库不做硬删除，只做软标记。所以数据库要增加一个用户是否已删除字段。
- 操作日志 每一次操作完成时生成一条操作日志
  - 操作人
  - 操作时间
  - 操作类型
    - 删除、增加、编辑、查询等等，做成类型可以方便后续搜索过滤
    - 所以这个类型的枚举，后面定一下
  - 操作内容
  - 操作日志最多保留三年 -- 灵活处理
  - 操作日志本身，也要做权限，有权限的人才能查看日志，查看日志这个事情不用记录日志。可查看的日志范围，不做限制
- 注意：特殊意义的用户名禁止使用
  - 敏感词服务
  - 如果敏感词范围变更，那么要做已有的用户信息的清洗，如果有违规的话，要定一个处理方式
    - 具体处理方式，参考通用的处理方式，或者停用，或者我们直接修改用户名等等
    - 如何通知，例如站内站外等。
  - 能不能修改用户名由权限控制
- 用户权限查看 查看用户权限，可以查看用户的权限 
  - 指的是内部员工查看某个外部用户的权限
  - 管理后台要支持搜索外部用户 -- 需要es
- 用户权限分配，一般通过选择确定用户的角色来快速完成对用户权限的分配，用户拥有某项权限才能看到对应的菜单和功能，才能进行某项功能操作。一种方式是通过用户列表右部操作区的权限分配按钮进行，一种是通过功能标签栏的权限分配按钮进行，此时需要搜选用户，相当于有两种入口。
  - 支持直接分配权限，也支持给用户关联角色
- 13. 
系统管理模块
3.1 功能描述
权限管理 建立功能模块、功能菜单下的各种具体操作项的权限构建成为权限体系，在此基础上，创建用户角色建立角色和权限的关联关系，通过用户权限分配实现用户和权限的关联关系，实现对用户操作权限的分配。
针对外部用户和内部用户，相同的子功能是完全隔离的，包括微服务和数据库。例如模块管理分为外部用户的模块管理和内部用户的模块管理，技术实现上，他们是隔离的。
关于模块管理、菜单管理、权限管理，他们是有层级关系的。
模块自己没有层级关系，或者可以理解为只有一层。
 3.2 页面设计与交互流程 
- 模块管理 
创建和管理模块。完成多个模块创建后，数据列表区看到的是一列模块，同时模块会出现在左边的侧边栏。创建时指定排序号，对模块在数据列表以及左边侧边栏的模块菜单区的排序进行调整，两个地方的顺序是一致的。
- 外部用户模块
- 内部用户模块

- 菜单管理
创建和管理菜单。菜单是在模块下面一级的，现在一般只做两级，也就是模块和菜单，创建完毕后，数据列表区就会出现所有的模块和菜单
- 权限管理 
创建和管理权限，展示所有模块、菜单、权限。创建好所有的权限，是角色创建和给用户分配权限的前置条件。每创建一个权限，都会出现在权限详情页面录入的对应模块和菜单下，某个特定权限的权限详情或者权限档案页面里主要包含以下信息：权限名称，所属模块，所属菜单，url接口地址，路由文件，控制代码，权限描述等信息。
对于url接口地址，路由文件，控制代码，主要表达的意思就是我们最终怎么和casbin对接，具体的实现形式或者字段可以是其他。可能的实现形式是，界面上展示一个下拉列表用于给当前权限选择action。

 